-- use master 
-- DROP DATABASE NhaKhoa 
-- go
use master
go
create database NhaKhoa
go
use NhaKhoa
go

CREATE TABLE BenhNhan 
(
    SODT VARCHAR(10) PRIMARY KEY,
    HOTEN NVARCHAR(50),
    PHAI NVARCHAR(5) CHECK(PHAI IN (N'Nam', N'Nữ')),
    NGAYSINH DATE,
	DIACHI NVARCHAR(250),
	MATKHAU VARCHAR(20), 
	
);


CREATE TABLE BacSi 
(
    IDBS VARCHAR(10) PRIMARY KEY,
    HOTEN NVARCHAR(50),
    PHAI NVARCHAR(5) CHECK(PHAI IN (N'Nam', N'Nữ')),
	DIACHI NVARCHAR(500),
	MATKHAU VARCHAR(20),
);

CREATE TABLE NhanVien 
(
    IDNV VARCHAR(10) PRIMARY KEY,
    HOTEN NVARCHAR(50),
    PHAI NVARCHAR(5) CHECK(PHAI IN (N'Nam', N'Nữ')),
	MATKHAU VARCHAR(20)
);

CREATE TABLE Ad 
(
    IDAD VARCHAR(10) PRIMARY KEY,
    HOTEN NVARCHAR(50),
	MATKHAU VARCHAR(20),
);
CREATE TABLE LichLam
(
	IDBS VARCHAR(10),
	IDLICHLAM VARCHAR(10),
	GIOBATDAU TIME,
	GIOKETTHUC TIME 
	PRIMARY KEY (IDBS,IDLICHLAM),
);

CREATE TABLE CaKham
(
	IDBS VARCHAR(10),
	TRANGTHAI NVARCHAR(200),
	IDLICHLAM VARCHAR(10),
	SODT VARCHAR(10)
	PRIMARY KEY(IDBS, SODT)
);
CREATE TABLE Thuoc
(
	IDTHUOC VARCHAR(10) PRIMARY KEY,
    TENTHUOC NVARCHAR(50),
	CHIDINH NVARCHAR(200),
	NGAYHETHAN DATE,
	DONGIA FLOAT CHECK (DONGIA > 0)
);
CREATE TABLE DichVu
(
	IDDV VARCHAR(10),
    TENDV NVARCHAR(50),
	SODT VARCHAR(10),
    MOTA NVARCHAR(500),
	DONGIA FLOAT CHECK (DONGIA > 0),
	SOLUONG INT CHECK(SOLUONG > 0), 
	PRIMARY KEY(IDDV,SODT)
);

CREATE TABLE BenhAn
(
	SODT VARCHAR(10) PRIMARY KEY,
	NGAYKHAM DATE,
	GhiChuCuaBacSi NVARCHAR(500),
	IDBS VARCHAR(10),
	_DAXUATHOADON BIT DEFAULT 0
);

CREATE TABLE HoaDon
(
	SODT VARCHAR(10),
	NGAYXUAT DATE,
	TONGCHIPHI FLOAT CHECK (TONGCHIPHI > 0),
	_DATHANHTOAN BIT DEFAULT 0,
	IDNV VARCHAR(10)
	PRIMARY KEY(SODT)
); 
ALTER TABLE LichLam 
ADD CONSTRAINT FK_LL_BS 
FOREIGN KEY (IDBS) 
REFERENCES BacSi(IDBS);

ALTER TABLE CaKham
ADD CONSTRAINT FK_CK_LL
FOREIGN KEY(IDBS,IDLICHLAM)
REFERENCES LichLam(IDBS,IDLICHLAM);


ALTER TABLE CaKham
ADD CONSTRAINT FK_CK_BN
FOREIGN KEY(SODT)
REFERENCES BenhNhan(SODT);

ALTER TABLE BenhAn
ADD CONSTRAINT FK_BA_BS
FOREIGN KEY(IDBS)
REFERENCES BacSi(IDBS);

ALTER TABLE BenhAn
ADD CONSTRAINT FK_BA_BN
FOREIGN KEY(SODT)
REFERENCES BenhNhan(SODT);

ALTER TABLE HoaDon
ADD CONSTRAINT FK_HD_BA
FOREIGN KEY(SODT)
REFERENCES BenhAn(SODT);

ALTER TABLE HoaDon
ADD CONSTRAINT FK_HD_NV
FOREIGN KEY(IDNV)
REFERENCES NhanVien(IDNV);

ALTER TABLE DichVu 
ADD CONSTRAINT FK_DV_BA 
FOREIGN KEY(SODT) 
REFERENCES BenhAn(SODT);
-- Dữ liệu giả cho bảng BenhNhan
INSERT INTO BenhNhan (SODT, HOTEN, PHAI, NGAYSINH, DIACHI, MATKHAU)
VALUES
    ('0123456789', N'Nguyễn Văn A', N'Nam', '1990-01-01', N'Hà Nội', 'password123'),
    ('0987654321', N'Nguyễn Thị B', N'Nữ', '1995-05-15', N'Hồ Chí Minh', 'abcxyz');

-- Dữ liệu giả cho bảng BacSi
INSERT INTO BacSi (IDBS, HOTEN, PHAI, DIACHI, MATKHAU)
VALUES
    ('BS001', N'Bác Sĩ X', N'Nam', N'Đà Nẵng', 'doctor456'),
    ('BS002', N'Bác Sĩ Y', N'Nữ', N'Hải Phòng', 'medic789');

-- Dữ liệu giả cho bảng NhanVien
INSERT INTO NhanVien (IDNV, HOTEN, PHAI, MATKHAU)
VALUES
    ('NV001', N'Nhân Viên P', N'Nam', 'staff123'),
    ('NV002', N'Nhân Viên Q', N'Nữ', 'employee456');

-- Dữ liệu giả cho bảng Ad
INSERT INTO Ad (IDAD, HOTEN, MATKHAU)
VALUES
    ('AD001', N'Quản Trị Hệ Thống', 'admin789');

-- Dữ liệu giả cho bảng LichLam
INSERT INTO LichLam (IDBS, IDLICHLAM, GIOBATDAU, GIOKETTHUC)
VALUES
    ('BS001', 'LL001', '08:00', '12:00'),
    ('BS002', 'LL002', '13:00', '17:00');

-- Dữ liệu giả cho bảng CaKham
INSERT INTO CaKham (IDBS, TRANGTHAI, IDLICHLAM, SODT)
VALUES
    ('BS001', N'Đã khám', 'LL001', '0123456789'),
    ('BS002', N'Chưa khám', 'LL002', '0987654321');

-- Dữ liệu giả cho bảng Thuoc
INSERT INTO Thuoc (IDTHUOC, TENTHUOC, CHIDINH, NGAYHETHAN, DONGIA)
VALUES
    ('T001', N'Paracetamol', N'Đau đầu, sốt', '2024-01-01', 5.0),
    ('T002', N'Amoxicillin', N'Nhiễm khuẩn', '2023-12-31', 7.5);

-- Dữ liệu giả cho bảng BenhAn
INSERT INTO BenhAn (SODT, NGAYKHAM, GhiChuCuaBacSi, IDBS)
VALUES
    ('0123456789', '2023-01-15', N'Bệnh nhân khỏe mạnh', 'BS001'),
    ('0987654321', '2023-02-20', N'Bệnh nhân cần theo dõi', 'BS002');
-- Dữ liệu giả cho bảng DichVu
INSERT INTO DichVu (IDDV, TENDV, SODT, MOTA, DONGIA, SOLUONG)
VALUES
    ('DV001', N'Tư vấn dinh dưỡng', '0123456789', N'Tư vấn chế độ ăn', 10.0, 1),
    ('DV002', N'Xét nghiệm máu', '0987654321', N'Kiểm tra sức khỏe', 15.0, 1);


-- Dữ liệu giả cho bảng HoaDon
INSERT INTO HoaDon (SODT, NGAYXUAT, TONGCHIPHI, IDNV)
VALUES
    ('0123456789', '2023-01-15', 20.0, 'NV001'),
    ('0987654321', '2023-02-20', 25.0, 'NV002');
